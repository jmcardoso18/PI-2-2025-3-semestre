{% extends 'core/base_dashboard.html' %}

{% block content %}
    <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4 mb-8">
        <div>
            <h1 class="font-display text-2xl sm:text-3xl">Cronograma do evento</h1>
            <p class="mt-2 text-sm text-neutral-700 max-w-lg">
                Acompanhe as atividades, horários e lista de convidados para manter a equipe alinhada.
            </p>
        </div>

        <div class="text-xs sm:text-sm text-neutral-600 bg-white/50 p-4 rounded-lg border border-neutral-200">
            <p><span class="font-semibold">Evento:</span> {{ evento.nome }}</p>
            <p><span class="font-semibold">Data:</span> {{ evento.data|date:"d/m/Y" }}</p>
            <p><span class="font-semibold">Local:</span> {{ evento.local }}</p>
        </div>
    </div>

    <section class="rounded-2xl bg-white shadow-md p-5 sm:p-6 space-y-4 mb-6">
        <div class="flex items-center justify-between gap-4">
            <h2 class="text-sm sm:text-base font-semibold tracking-wide text-neutral-800">
                Atividades do dia
            </h2>
            <span class="text-[10px] sm:text-[11px] uppercase tracking-[0.15em] text-neutral-500">
                Atividade · Horário · Check
            </span>
        </div>

        <div class="border border-neutral-200 rounded-xl overflow-hidden bg-neutral-50/80">
            <div class="divide-y divide-neutral-200">
                {% for atividade in atividades %}
                <div class="grid grid-cols-[1fr_auto_auto] gap-2 px-4 py-3 items-center text-sm bg-white/60 hover:bg-neutral-50 transition group">
                    <div>
                        <p id="text-{{ atividade.id }}" class="font-medium text-neutral-900 transition-all {% if atividade.feito %}line-through text-neutral-400{% endif %}">
                            {{ atividade.nome }}
                        </p>
                    </div>
                    <span class="inline-flex justify-center rounded-full border border-neutral-300 bg-white px-3 py-1 text-xs font-semibold text-neutral-800">
                        {{ atividade.horario|time:"H:i" }}
                    </span>
                    <button onclick="toggleAtividade({{ atividade.id }})" id="btn-{{ atividade.id }}"
                        class="inline-flex h-7 w-7 items-center justify-center rounded-full border text-xs font-semibold transition cursor-pointer
                        {% if atividade.feito %}border-emerald-500 bg-emerald-500 text-white{% else %}border-neutral-300 bg-white text-neutral-700 hover:bg-neutral-100{% endif %}">
                        {% if atividade.feito %}✓{% else %}OK{% endif %}
                    </button>
                </div>
                {% empty %}
                <div class="p-4 text-center text-sm text-neutral-500">Nenhuma atividade cadastrada.</div>
                {% endfor %}
            </div>
        </div>
    </section>

    <section class="rounded-2xl bg-white shadow-md p-5 sm:p-6 space-y-4">
        <div class="flex items-center justify-between gap-4">
            <h2 class="text-sm sm:text-base font-semibold tracking-wide text-neutral-800">
                Lista de Convidados
            </h2>
            <span class="text-[10px] sm:text-[11px] uppercase tracking-[0.15em] text-neutral-500">
                Total: {{ convidados.count }}
            </span>
        </div>

        <div class="overflow-x-auto border border-neutral-200 rounded-xl">
            <table class="w-full text-left text-sm text-neutral-600">
                <thead class="bg-neutral-100/70 text-xs uppercase text-neutral-500 font-semibold">
                    <tr>
                        <th class="px-4 py-3">Nome</th>
                        <th class="px-4 py-3 text-center">Acomp.</th>
                        <th class="px-4 py-3 text-center">Status</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-neutral-200 bg-white">
                    {% for convidado in convidados %}
                    <tr class="hover:bg-neutral-50 transition">
                        <td class="px-4 py-3 font-medium text-neutral-900">{{ convidado.nome }}</td>
                        <td class="px-4 py-3 text-center">+{{ convidado.acompanhantes }}</td>
                        <td class="px-4 py-3 text-center">
                            <span class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium 
                            {% if convidado.status == 'Confirmado' %}bg-green-50 text-green-700 ring-green-600/20
                            {% elif convidado.status == 'Recusado' %}bg-red-50 text-red-700 ring-red-600/20
                            {% else %}bg-yellow-50 text-yellow-800 ring-yellow-600/20{% endif %} ring-1 ring-inset">
                                {{ convidado.status }}
                            </span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="3" class="p-6 text-center text-neutral-500">Lista vazia.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
{% endblock %}

{% block scripts %}
<script>
    function toggleAtividade(id) {
        fetch(`/api/toggle-atividade/${id}/`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
        })
        .then(response => response.json())
        .then(data => {
            if(data.status === 'sucesso') {
                const textElement = document.getElementById(`text-${id}`);
                const btnElement = document.getElementById(`btn-${id}`);
                if(data.feito) {
                    textElement.classList.add('line-through', 'text-neutral-400');
                    btnElement.classList.remove('border-neutral-300', 'bg-white', 'text-neutral-700');
                    btnElement.classList.add('border-emerald-500', 'bg-emerald-500', 'text-white');
                    btnElement.innerText = '✓';
                } else {
                    textElement.classList.remove('line-through', 'text-neutral-400');
                    btnElement.classList.add('border-neutral-300', 'bg-white', 'text-neutral-700');
                    btnElement.classList.remove('border-emerald-500', 'bg-emerald-500', 'text-white');
                    btnElement.innerText = 'OK';
                }
            }
        });
    }
</script>
{% endblock %}